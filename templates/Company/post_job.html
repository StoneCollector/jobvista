{% extends 'base.html' %}
{% block title %}Company Dashboard - JobVista{% endblock %}
{% block content %}
<div class="w-full px-6 lg:px-10 py-8" style="background: radial-gradient(1600px 900px at -10% -20%, #EEF2FF, transparent), radial-gradient(1400px 800px at 120% 0%, #F5F7FF, transparent);">
  <div class="max-w-7xl mx-auto">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold" style="color: var(--text-heading);">Company Dashboard</h1>
        <p class="text-sm text-gray-600">Manage your company profile and jobs</p>
      </div>
      <div class="flex items-center gap-3">
        <div class="hidden sm:flex items-center gap-2 text-xs">
          <span class="text-gray-500">Status</span>
          <span class="pill">{{ company.get_status_display|default:company.status }}</span>
        </div>
        <span class="text-sm text-gray-600">{{ company.name }}</span>
        {% if company.logo %}
          <img src="{{ company.logo.url }}" class="w-10 h-10 rounded-lg object-contain border bg-white p-1" style="border-color: var(--border);" alt="{{ company.name }}"/>
        {% endif %}
        <a href="{% url 'update_company' company.pk %}" class="btn-secondary-brand px-3 py-2 rounded-md">Edit Company</a>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow hover:shadow-md transition-all" style="border-color:#ffffff33;">
        <div class="flex items-center gap-3 mb-1">
          <i class="fas fa-briefcase text-blue-600"></i>
          <div class="text-gray-600 text-sm">Active Jobs</div>
        </div>
        <div class="text-2xl font-semibold">{{ active_jobs_count }}</div>
      </div>
      <div class="backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow hover:shadow-md transition-all" style="border-color:#ffffff33;">
        <div class="flex items-center gap-3 mb-1">
          <i class="fas fa-archive text-yellow-600"></i>
          <div class="text-gray-600 text-sm">Closed Jobs</div>
        </div>
        <div class="text-2xl font-semibold">{{ closed_jobs_count }}</div>
      </div>
      <a href="{% url 'company_applicants' %}" class="block backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow hover:shadow-md transition-all" style="border-color:#ffffff33;">
        <div class="flex items-center gap-3 mb-1">
          <i class="fas fa-user-friends text-green-600"></i>
          <div class="text-gray-600 text-sm">Applicants</div>
        </div>
        <div class="text-2xl font-semibold">{{ applicants_count }}</div>
      </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <section class="lg:col-span-7 backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow" style="border-color:#ffffff33;">
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-semibold" style="color: var(--text-heading);">Post a New Job</h2>
          <span class="text-xs text-gray-500">Quick Apply enabled by default</span>
        </div>
        <form class="space-y-4" method="post" action="{% url 'create_job' %}">
          {% csrf_token %}
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Job Title</label>
              <input class="input w-full" name="title" placeholder="e.g. Software Engineer" required />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Location</label>
              <input class="input w-full" name="location" placeholder="e.g. Mumbai" required />
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Employment Type</label>
              <select class="input w-full" name="employment_type" required>
                {% for value,label in job_employment_types %}
                  <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Experience</label>
              <select class="input w-full" name="experience_level" required>
                {% for value,label in job_experience_levels %}
                  <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="block text-sm font-medium mb-1">Salary Min</label>
                <input type="number" class="input w-full" name="salary_min" placeholder="₹" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Salary Max</label>
                <input type="number" class="input w-full" name="salary_max" placeholder="₹" />
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="flex items-center gap-2">
              <input type="checkbox" id="remote" name="remote_available" class="rounded border-gray-300" />
              <label for="remote" class="text-sm">Remote Available</label>
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium mb-1">Application Deadline</label>
              <input type="date" class="input w-full" name="application_deadline" />
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Category</label>
            <select class="input w-full" name="category" required>
              {% for cat in categories %}
                <option value="{{ cat.id }}">{{ cat.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Description</label>
            <textarea class="input w-full" rows="4" name="description" placeholder="Describe the job, responsibilities and requirements..." required></textarea>
          </div>
          <input type="hidden" name="requirements" value="" />
          <input type="hidden" name="responsibilities" value="" />
          <div>
            <label class="block text-sm font-medium mb-1">Tags (comma separated)</label>
            <input class="input w-full" placeholder="e.g. Remote, React, Mid Level" />
          </div>
          <div class="flex items-center justify-end gap-2">
            <button type="button" class="btn-secondary-brand px-4 py-2 rounded-md">Save as Draft</button>
            <button type="submit" class="btn-primary-brand px-5 py-2 rounded-md">Publish Job</button>
          </div>
        </form>
      </section>

      <section class="lg:col-span-5 space-y-6">
        <div class="backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow" style="border-color:#ffffff33;">
          <div class="flex items-center justify-between mb-3">
            <h2 class="font-semibold" style="color: var(--text-heading);">Your Active Jobs</h2>
            <a class="link text-sm" href="#">View all</a>
          </div>
          <div class="rounded border overflow-hidden" style="border-color: var(--border);">
            <table class="min-w-full">
              <thead>
              <tr class="bg-white/70">
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Title</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Type</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Applicants</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Status</th>
                <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 pr-6">Actions</th>
                </tr>
              </thead>
              <tbody class="divide-y" style="border-color: var(--border);">
                {% for j in company.jobs.all %}
                  <tr class="hover:bg-white/70 transition-colors cursor-pointer" onclick="window.location='{% url 'company_applicants' %}?job={{ j.id }}'" role="button">
                    <td class="px-4 py-3">
                      <span class="font-medium" style="color: var(--text-heading);">{{ j.title }}</span>
                      <div class="text-xs text-gray-500">{{ j.location }} • {{ j.created_at|timesince }} ago</div>
                    </td>
                    <td class="px-4 py-3"><span class="pill" style="white-space: nowrap;">{{ j.get_employment_type_display }}</span></td>
                    <td class="px-4 py-3">{{ j.applied.count }}</td>
                    <td class="px-4 py-3"><span class="pill" style="white-space: nowrap;">{% if j.is_active %}Active{% else %}Closed{% endif %}</span></td>
                    <td class="px-4 py-3 space-x-2 text-sm text-right pr-6">
                      <a class="link" href="{{ j.get_absolute_url }}" onclick="event.stopPropagation()">View</a>
                      <span class="text-gray-300">|</span>
                      <span class="text-gray-400" onclick="event.stopPropagation()">Edit</span>
                      <span class="text-gray-300">|</span>
                      <a class="link" href="{% url 'company_applicants' %}?job={{ j.id }}" onclick="event.stopPropagation()">Applicants</a>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td class="px-4 py-6 text-sm text-gray-500" colspan="5">No jobs yet. Use the form to post your first role.</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <div class="backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow" style="border-color:#ffffff33;">
          <h3 class="font-semibold mb-2" style="color: var(--text-heading);">Tips to attract talent</h3>
          <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
            <li>Keep titles clear (e.g., "Senior Backend Engineer").</li>
            <li>List 5-8 core responsibilities and 5-7 skills.</li>
            <li>Share salary range to boost conversion.</li>
            <li>Add 3-5 tags like React, Django, Remote.</li>
          </ul>
        </div>
      </section>
    </div>
  </div>
</div>
{% endblock %}