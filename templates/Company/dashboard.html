{% extends 'base.html' %}
{% load static %}

{% block title %}Company Dashboard - JobVista{% endblock %}

{% block content %}
<style>
    .company-dashboard-container {
        display: flex;
        min-height: 100vh;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    }
    
    .company-sidebar {
        width: 280px;
        background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 50%, #2563eb 100%);
        color: white;
        padding: 0;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
        transition: all 0.3s ease;
        box-shadow: 0 0 30px rgba(30, 58, 138, 0.25);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    
    .company-main-content {
        flex: 1;
        margin-left: 280px;
        transition: all 0.3s ease;
        min-height: 100vh;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    }
    
    
    .company-content-wrapper {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .company-sidebar-header {
        padding: 2rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
    }
    
    .company-sidebar-nav {
        padding: 1rem 0;
    }
    
    .company-nav-item {
        display: flex;
        align-items: center;
        padding: 0.875rem 1.5rem;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
        margin: 0.25rem 0;
    }
    
    .company-nav-item:hover,
    .company-nav-item.active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-left-color: #fbbf24;
        transform: translateX(4px);
    }
    
    .company-nav-item i {
        width: 20px;
        margin-right: 0.75rem;
        font-size: 1.1rem;
    }
    
    .company-nav-item span {
        font-weight: 500;
        font-size: 0.9rem;
    }
    
    
    .company-content-section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2.5rem;
        margin-bottom: 2.5rem;
        box-shadow: 0 8px 32px rgba(30, 58, 138, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }
    
    .company-content-section:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(30, 58, 138, 0.15);
    }
    
    .company-section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0.5rem;
    }
    
    .company-section-subtitle {
        color: #64748b;
        font-size: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .company-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .company-stat-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 8px 32px rgba(30, 58, 138, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.3);
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }
    
    .company-stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #3b82f6, #1e40af, #2563eb);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .company-stat-card:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 16px 48px rgba(30, 58, 138, 0.15);
    }
    
    .company-stat-card:hover::before {
        opacity: 1;
    }
    
    .company-stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #1e40af;
        margin-bottom: 0.5rem;
    }
    
    .company-stat-label {
        color: #64748b;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .company-job-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(30, 58, 138, 0.1);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }
    
    .company-job-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #3b82f6, #1e40af);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .company-job-card:hover {
        transform: translateY(-3px) scale(1.01);
        box-shadow: 0 12px 40px rgba(30, 58, 138, 0.12);
        border-color: rgba(30, 58, 138, 0.2);
    }
    
    .company-job-card:hover::before {
        opacity: 1;
    }
    
    .company-job-form {
        background: #f8fafc;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid #e2e8f0;
        display: none;
    }
    
    .company-job-form.show {
        display: block;
    }
    
    .company-form-group {
        margin-bottom: 1.5rem;
    }
    
    .company-form-label {
        display: block;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
    
    .company-form-control {
        width: 100%;
        padding: 1rem;
        border: 1px solid rgba(30, 58, 138, 0.2);
        border-radius: 12px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
    }
    
    .company-form-control:focus {
        outline: none;
        border-color: #1e40af;
        box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.1);
        background: white;
        transform: translateY(-1px);
    }
    
    .company-btn-primary {
        background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
        color: white;
        border: none;
        padding: 0.875rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.4s ease;
        text-decoration: none;
        display: inline-block;
        font-size: 0.9rem;
        box-shadow: 0 4px 16px rgba(30, 64, 175, 0.2);
        position: relative;
        overflow: hidden;
    }
    
    .company-btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
    }
    
    .company-btn-primary:hover {
        background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(30, 64, 175, 0.4);
    }
    
    .company-btn-primary:hover::before {
        left: 100%;
    }
    
    .company-btn-secondary {
        background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        color: white;
        border: none;
        padding: 0.75rem 1.25rem;
        border-radius: 12px;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.4s ease;
        text-decoration: none;
        display: inline-block;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(100, 116, 139, 0.2);
    }
    
    .company-btn-secondary:hover {
        background: linear-gradient(135deg, #475569 0%, #334155 100%);
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(100, 116, 139, 0.3);
    }
    
    .company-header-card {
        background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #2563eb 100%);
        color: white;
        border-radius: 20px;
        padding: 2.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 12px 40px rgba(30, 58, 138, 0.25);
        position: relative;
        overflow: hidden;
    }
    
    .company-header-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.05) 100%);
        pointer-events: none;
    }
    
    .company-logo-header {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        object-fit: cover;
    }
    
    .company-logo-placeholder-header {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    
    .status-badge {
        padding: 0.375rem 0.875rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-active {
        background: #dcfce7;
        color: #166534;
    }
    
    .status-inactive {
        background: #fef3c7;
        color: #92400e;
    }
    
    .company-applicant-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(30, 58, 138, 0.1);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }
    
    .company-applicant-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #3b82f6, #1e40af);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .company-applicant-card:hover {
        transform: translateY(-3px) scale(1.01);
        box-shadow: 0 12px 40px rgba(30, 58, 138, 0.12);
        border-color: rgba(30, 58, 138, 0.2);
    }
    
    .company-applicant-card:hover::before {
        opacity: 1;
    }
    
    .company-page-content {
        display: none;
    }
    
    .company-page-content.active {
        display: block;
    }
    
    @media (max-width: 768px) {
        .company-sidebar {
            width: 100%;
            position: relative;
            height: auto;
        }
        
        .company-main-content {
            margin-left: 0;
        }
        
        .company-content-wrapper {
            padding: 1rem;
        }
    }
</style>

<div class="company-dashboard-container">
    <!-- CSRF Token for JavaScript -->
    {% csrf_token %}
    
    <!-- Company Sidebar -->
    <div class="company-sidebar" id="companySidebar">
        <div class="company-sidebar-header">
            <div class="d-flex align-items-center justify-content-center">
                {% if company.logo %}
                    <img src="{{ company.logo.url }}" alt="{{ company.name }}" style="width: 50px; height: 50px; border-radius: 12px; margin-right: 1rem;">
                {% else %}
                    <div style="width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                        <i class="fas fa-building"></i>
                    </div>
                {% endif %}
                <div>
                    <h5 class="mb-0">{{ company.name }}</h5>
                    <p class="mb-0 opacity-75" style="font-size: 0.8rem;">Company Dashboard</p>
                </div>
            </div>
        </div>
        
        <nav class="company-sidebar-nav">
            <a href="#" class="company-nav-item active" onclick="showPage('dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="company-nav-item" onclick="showPage('post-job')">
                <i class="fas fa-plus"></i>
                <span>Post New Job</span>
            </a>
            <a href="#" class="company-nav-item" onclick="showPage('applicants')">
                <i class="fas fa-users"></i>
                <span>All Applicants</span>
            </a>
            <a href="#" class="company-nav-item" onclick="showPage('my-jobs')">
                <i class="fas fa-briefcase"></i>
                <span>My Jobs</span>
            </a>
            <a href="#" class="company-nav-item" onclick="showPage('company-profile')">
                <i class="fas fa-building"></i>
                <span>Company Profile</span>
            </a>
            <a href="{% url 'logout' %}" class="company-nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </nav>
    </div>
    
    <!-- Main Content -->
    <div class="company-main-content" id="companyMainContent">
        <div class="company-content-wrapper">
            
            <!-- Dashboard Page -->
            <div class="company-page-content active" id="dashboard-page">
                <!-- Company Header -->
                <div class="company-header-card">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex align-items-center">
                                {% if company.logo %}
                                    <img src="{{ company.logo.url }}" alt="{{ company.name }}" class="company-logo-header me-3">
                                {% else %}
                                    <div class="company-logo-placeholder-header me-3">
                                        <i class="fas fa-building"></i>
                                    </div>
                                {% endif %}
                                <div>
                                    <h1 class="mb-1">{{ company.name }}</h1>
                                    <p class="mb-0 opacity-90">Technology • {{ company.location }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <button class="btn btn-light me-2" onclick="showPage('post-job')">
                                <i class="fas fa-plus me-2"></i>Post New Job
                            </button>
                            <button class="btn btn-outline-light" onclick="showPage('company-profile')">
                                <i class="fas fa-edit me-2"></i>Edit Company
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="company-stats-grid">
                    <div class="company-stat-card">
                        <div class="company-stat-number">{{ total_jobs }}</div>
                        <div class="company-stat-label">Total Jobs</div>
                    </div>
                    <div class="company-stat-card">
                        <div class="company-stat-number">{{ active_jobs_count }}</div>
                        <div class="company-stat-label">Active Jobs</div>
                    </div>
                    <div class="company-stat-card">
                        <div class="company-stat-number">{{ total_applications }}</div>
                        <div class="company-stat-label">Total Applications</div>
                    </div>
                    <div class="company-stat-card">
                        <div class="company-stat-number">{{ pending_applications }}</div>
                        <div class="company-stat-label">Pending Applications</div>
                    </div>
                </div>

                <!-- Recent Jobs -->
                <div class="company-content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="company-section-title">Recent Jobs</h4>
                            <p class="company-section-subtitle">Your latest job postings</p>
                        </div>
                        <button class="company-btn-secondary" onclick="showPage('my-jobs')">View All</button>
                    </div>
                    
                    {% if recent_jobs %}
                        {% for job in recent_jobs %}
                            <div class="company-job-card">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h5 class="mb-2">{{ job.title }}</h5>
                                        <p class="text-muted mb-2">{{ job.location }} • {{ job.get_employment_type_display }}</p>
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="status-badge {% if job.is_active %}status-active{% else %}status-inactive{% endif %}">
                                                {% if job.is_active %}Active{% else %}Inactive{% endif %}
                                            </span>
                                            <span class="text-muted">Posted {{ job.created_at|date:"M d, Y" }}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <button class="company-btn-secondary me-2" onclick="showPage('applicants', {{ job.id }})">
                                            <i class="fas fa-users me-1"></i>View Applicants
                                        </button>
                                        <button class="company-btn-primary">
                                            <i class="fas fa-edit me-1"></i>Edit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-briefcase fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No jobs posted yet</h5>
                            <p class="text-muted">Click "Post New Job" to create your first job posting.</p>
                        </div>
                    {% endif %}
                </div>

                <!-- AI Company Insights -->
                {% if ai_insights %}
                <div class="company-content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="company-section-title">
                                <i class="fas fa-robot me-2" style="color: #1e40af;"></i>AI Company Insights
                            </h4>
                            <p class="company-section-subtitle">AI-powered analysis of your hiring performance</p>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <div class="h4 mb-0 text-primary">{{ ai_insights.efficiency_score }}%</div>
                                <div class="small text-muted">Efficiency Score</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-chart-line me-2 text-success"></i>Hiring Trends</h6>
                            <ul class="list-unstyled">
                                {% for trend in ai_insights.hiring_trends %}
                                    <li><i class="fas fa-arrow-up text-success me-2"></i>{{ trend }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-lightbulb me-2 text-warning"></i>Recommendations</h6>
                            <ul class="list-unstyled">
                                {% for rec in ai_insights.recommendations %}
                                    <li><i class="fas fa-check text-primary me-2"></i>{{ rec }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6><i class="fas fa-rocket me-2 text-info"></i>Growth Opportunities</h6>
                            <ul class="list-unstyled">
                                {% for opp in ai_insights.growth_opportunities %}
                                    <li><i class="fas fa-star text-warning me-2"></i>{{ opp }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-list-check me-2 text-primary"></i>Next Steps</h6>
                            <ul class="list-unstyled">
                                {% for step in ai_insights.next_steps %}
                                    <li><i class="fas fa-arrow-right text-success me-2"></i>{{ step }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Recent Applications -->
                <div class="company-content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="company-section-title">Recent Applications</h4>
                            <p class="company-section-subtitle">Latest job applications</p>
                        </div>
                        <button class="company-btn-secondary" onclick="showPage('applicants')">View All</button>
                    </div>
                    
                    {% if recent_applications %}
                        {% for application in recent_applications %}
                            <div class="company-applicant-card">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h6 class="mb-1">{{ application.user.get_full_name|default:application.user.username }}</h6>
                                        <p class="text-muted mb-1">{{ application.job.title }}</p>
                                        <small class="text-muted">Applied {{ application.created_at|date:"M d, Y" }}</small>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <span class="badge {% if application.status == 'pending' %}bg-warning{% elif application.status == 'accepted' %}bg-success{% else %}bg-danger{% endif %}">
                                            {{ application.get_status_display }}
                                        </span>
                                        <button class="company-btn-primary ms-2">
                                            View Details
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-users fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No applications yet</h5>
                            <p class="text-muted">Applications will appear here once candidates start applying to your jobs.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Post Job Page -->
            <div class="company-page-content" id="post-job-page">
                <div class="company-content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="company-section-title">Post a New Job</h4>
                            <p class="company-section-subtitle">Create a job posting to attract qualified candidates</p>
                        </div>
                        <button class="btn btn-outline-secondary" onclick="showPage('dashboard')">
                            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <!-- AI-Powered Job Posting Generator -->
                    <div class="company-content-section mb-4">
                        <div class="company-stat-card">
                            <div class="d-flex align-items-center mb-3">
                                <div class="me-3">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; background: linear-gradient(135deg, #059669 0%, #10b981 100%);">
                                        <i class="fas fa-magic text-white" style="font-size: 1.2rem;"></i>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="company-section-title mb-1">AI Job Posting Generator</h5>
                                    <p class="company-section-subtitle mb-0">Describe your job in natural language and let AI fill all the fields</p>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="company-form-label">Describe the job you want to post:</label>
                                <textarea id="aiJobPrompt" class="company-form-control" rows="3" placeholder="e.g., We need a senior Python developer with Django experience to work on our web application. Should have 5+ years experience, know AWS, and be comfortable with remote work. Looking for someone who can lead a team and mentor junior developers."></textarea>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button class="company-btn-primary" onclick="generateAIJobPosting()">
                                    <i class="fas fa-magic me-2"></i>Generate Job Posting
                                </button>
                                <button class="btn btn-outline-secondary" onclick="clearAIForm()">
                                    <i class="fas fa-eraser me-2"></i>Clear
                                </button>
                            </div>
                        </div>
                    </div>

                   

                    <form method="POST" action="{% url 'post_job' %}">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-6">
                                <div class="company-form-group">
                                    <label class="company-form-label">Job Title</label>
                                    <input type="text" name="title" class="company-form-control" placeholder="e.g. Senior Software Engineer" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="company-form-group">
                                    <label class="company-form-label">Location</label>
                                    <input type="text" name="location" class="company-form-control" placeholder="e.g. New York, NY" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="company-form-group">
                            <label class="company-form-label">Job Description</label>
                            <textarea name="description" class="company-form-control" rows="4" placeholder="Describe the role and responsibilities..." required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="company-form-group">
                                    <label class="company-form-label">Employment Type</label>
                                    <select name="employment_type" class="company-form-control" required>
                                        <option value="full_time">Full Time</option>
                                        <option value="part_time">Part Time</option>
                                        <option value="contract">Contract</option>
                                        <option value="internship">Internship</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="company-form-group">
                                    <label class="company-form-label">Experience Level</label>
                                    <select name="experience_level" class="company-form-control" required>
                                        <option value="entry">Entry Level</option>
                                        <option value="mid">Mid Level</option>
                                        <option value="senior">Senior Level</option>
                                        <option value="executive">Executive</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="company-form-group">
                                    <label class="company-form-label">Salary Range</label>
                                    <input type="text" name="salary_range" class="company-form-control" placeholder="e.g. $80,000 - $120,000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="company-form-group">
                            <label class="company-form-label">Requirements</label>
                            <textarea name="requirements" class="company-form-control" rows="3" placeholder="List the key requirements and qualifications..."></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="company-form-group">
                                    <label class="company-form-label">Category</label>
                                    <select name="category" class="company-form-control" required>
                                        <option value="">Select Category</option>
                                        {% for category in categories %}
                                            <option value="{{ category.id }}">{{ category.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="company-form-group">
                                    <label class="company-form-label">Remote Work</label>
                                    <select name="remote_work" class="company-form-control">
                                        <option value="no">No Remote Work</option>
                                        <option value="hybrid">Hybrid</option>
                                        <option value="full_remote">Fully Remote</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-center gap-3 mb-4">
                            <div class="form-check">
                                <input type="checkbox" name="is_active" class="form-check-input" id="isActive" checked>
                                <label class="form-check-label" for="isActive">Active Job Posting</label>
                            </div>
                        </div>
                        
                        <div class="text-end">
                            <button type="button" class="btn btn-outline-secondary me-2" onclick="showPage('dashboard')">Cancel</button>
                            <button type="submit" class="company-btn-primary">
                                <i class="fas fa-paper-plane me-2"></i>Post Job
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Applicants Page -->
            <div class="company-page-content" id="applicants-page">
                <div class="company-content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="company-section-title">Job Applicants</h4>
                            <p class="company-section-subtitle">View and manage applications for your job postings</p>
                        </div>
                        <button class="btn btn-outline-secondary" onclick="showPage('dashboard')">
                            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    {% if recent_applications %}
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center gap-2">
                                    <i class="fas fa-filter text-muted"></i>
                                    <select class="form-select" id="jobFilter" onchange="filterApplicants()">
                                        <option value="">All Jobs</option>
                                        {% for job in recent_jobs %}
                                            <option value="{{ job.id }}">{{ job.title }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center gap-2">
                                    <i class="fas fa-search text-muted"></i>
                                    <input type="text" class="form-control" id="applicantSearch" placeholder="Search applicants..." onkeyup="searchApplicants()">
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI-Powered Applicant Ranking -->
                        <div class="company-content-section mb-4">
                            <div class="company-stat-card">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="me-3">
                                        <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);">
                                            <i class="fas fa-robot text-white" style="font-size: 1.2rem;"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 class="company-section-title mb-1">AI-Powered Smart Screening</h5>
                                        <p class="company-section-subtitle mb-0">Candidates ranked by AI match score and potential</p>
                                    </div>
                                </div>
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <div class="h4 mb-1 text-primary">95%</div>
                                        <div class="small text-muted">Avg. Accuracy</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h4 mb-1 text-primary">2.3s</div>
                                        <div class="small text-muted">Analysis Time</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h4 mb-1 text-primary">24/7</div>
                                        <div class="small text-muted">AI Monitoring</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h4 mb-1 text-primary">Top 3</div>
                                        <div class="small text-muted">Best Matches</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {% for application in recent_applications %}
                            <div class="company-applicant-card" data-job-id="{{ application.job.id }}" data-applicant-name="{{ application.user.get_full_name|default:application.user.username|lower }}">
                                <div class="row align-items-center">
                                    <div class="col-md-1">
                                        <div class="d-flex align-items-center">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; background: #1e40af; color: white; font-weight: 600;">
                                                {{ application.user.first_name|first|default:application.user.username|first|upper }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="d-flex align-items-center mb-2">
                                            <h6 class="mb-0 me-2">{{ application.user.get_full_name|default:application.user.username }}</h6>
                                            {% if forloop.counter <= 3 %}
                                                <span class="badge bg-warning text-dark">
                                                    <i class="fas fa-star me-1"></i>Top {{ forloop.counter }}
                                                </span>
                                            {% endif %}
                                        </div>
                                        <p class="text-muted mb-1">{{ application.job.title }}</p>
                                        <small class="text-muted">
                                            <i class="fas fa-envelope me-1"></i>{{ application.user.email }}
                                        </small>
                                    </div>
                                    <div class="col-md-2">
                                        <!-- AI Match Score -->
                                        <div class="text-center">
                                            <div class="d-flex align-items-center mb-1">
                                                <i class="fas fa-robot me-1" style="color: #667eea; font-size: 0.8rem;"></i>
                                                <small class="text-muted">AI Score</small>
                                            </div>
                                            <div class="progress" style="height: 6px; width: 60px;">
                                                <div class="progress-bar {% if application.ai_match_score >= 80 %}bg-success{% elif application.ai_match_score >= 60 %}bg-warning{% else %}bg-danger{% endif %}" 
                                                     style="width: {{ application.ai_match_score }}%"></div>
                                            </div>
                                            <small class="fw-bold {% if application.ai_match_score >= 80 %}text-success{% elif application.ai_match_score >= 60 %}text-warning{% else %}text-danger{% endif %}">
                                                {{ application.ai_match_score }}%
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="badge {% if application.status == 'pending' %}bg-warning{% elif application.status == 'accepted' %}bg-success{% else %}bg-danger{% endif %} fs-6">
                                            {{ application.get_status_display }}
                                        </span>
                                    </div>
                                    <div class="col-md-2">
                                        <small class="text-muted">
                                            <i class="fas fa-clock me-1"></i>{{ application.created_at|date:"M d, Y" }}
                                        </small>
                                    </div>
                                    <div class="col-md-1">
                                        <button class="btn btn-outline-primary btn-sm" onclick="showAISummary({{ application.id }})" title="View AI Summary">
                                            <i class="fas fa-brain"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <div class="d-flex gap-2">
                                            <button class="company-btn-primary btn-sm" onclick="viewApplicantDetails({{ application.id }})">
                                                <i class="fas fa-eye me-1"></i>View Details
                                            </button>
                                            {% if application.status == 'pending' %}
                                                <button class="btn btn-success btn-sm" onclick="updateApplicationStatus({{ application.id }}, 'accepted')">
                                                    <i class="fas fa-check me-1"></i>Accept
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="updateApplicationStatus({{ application.id }}, 'rejected')">
                                                    <i class="fas fa-times me-1"></i>Reject
                                                </button>
                                            {% endif %}
                                            <button class="btn btn-info btn-sm" onclick="scheduleWithAI({{ application.id }})">
                                                <i class="fas fa-calendar-plus me-1"></i>Schedule with AI
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-users fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No applicants yet</h5>
                            <p class="text-muted">Applicants will appear here once candidates start applying to your jobs.</p>
                            <button class="company-btn-primary" onclick="showPage('post-job')">
                                <i class="fas fa-plus me-2"></i>Post Your First Job
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- My Jobs Page -->
            <div class="company-page-content" id="my-jobs-page">
                <div class="company-content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="company-section-title">My Jobs</h4>
                            <p class="company-section-subtitle">Manage your job postings and track applications</p>
                        </div>
                        <div>
                            <button class="company-btn-primary me-2" onclick="showPage('post-job')">
                                <i class="fas fa-plus me-2"></i>Post New Job
                            </button>
                            <button class="btn btn-outline-secondary" onclick="showPage('dashboard')">
                                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    {% if recent_jobs %}
                        {% for job in recent_jobs %}
                            <div class="company-job-card">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h5 class="mb-2">{{ job.title }}</h5>
                                        <p class="text-muted mb-2">{{ job.location }} • {{ job.get_employment_type_display }}</p>
                                        <div class="d-flex align-items-center gap-3">
                                            <span class="status-badge {% if job.is_active %}status-active{% else %}status-inactive{% endif %}">
                                                {% if job.is_active %}Active{% else %}Inactive{% endif %}
                                            </span>
                                            <span class="text-muted">Posted {{ job.created_at|date:"M d, Y" }}</span>
                                            <span class="text-muted">{{ job.applications.count }} applications</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <button class="company-btn-secondary me-2" onclick="showPage('applicants', {{ job.id }})">
                                            <i class="fas fa-users me-1"></i>View Applicants
                                        </button>
                                        <button class="company-btn-primary">
                                            <i class="fas fa-edit me-1"></i>Edit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-briefcase fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No jobs posted yet</h5>
                            <p class="text-muted">Start by posting your first job to attract qualified candidates.</p>
                            <button class="company-btn-primary" onclick="showPage('post-job')">
                                <i class="fas fa-plus me-2"></i>Post Your First Job
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Company Profile Page -->
            <div class="company-page-content" id="company-profile-page">
                <div class="company-content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 class="company-section-title">Company Profile</h4>
                            <p class="company-section-subtitle">Manage your company information and settings</p>
                        </div>
                        <button class="btn btn-outline-secondary" onclick="showPage('dashboard')">
                            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                        </button>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="company-job-card">
                                <h5 class="mb-3">Company Information</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Company Name:</strong> {{ company.name }}</p>
                                        <p><strong>Industry:</strong> Technology</p>
                                        <p><strong>Location:</strong> {{ company.location }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Company Size:</strong> {{ company.company_size }}</p>
                                        <p><strong>Website:</strong> <a href="{{ company.website }}" target="_blank">{{ company.website }}</a></p>
                                        <p><strong>Status:</strong> <span class="badge bg-success">{{ company.get_status_display }}</span></p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <p><strong>Description:</strong></p>
                                    <p class="text-muted">{{ company.description }}</p>
                                </div>
                                <div class="text-end mt-4">
                                    <a href="{% url 'update_company' company.id %}" class="company-btn-primary">
                                        <i class="fas fa-edit me-2"></i>Edit Company Profile
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="company-job-card text-center">
                                {% if company.logo %}
                                    <img src="{{ company.logo.url }}" alt="{{ company.name }}" style="width: 120px; height: 120px; border-radius: 12px; object-fit: cover; margin-bottom: 1rem;">
                                {% else %}
                                    <div style="width: 120px; height: 120px; background: #f1f5f9; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 3rem; color: #64748b;">
                                        <i class="fas fa-building"></i>
                                    </div>
                                {% endif %}
                                <h6>{{ company.name }}</h6>
                                <p class="text-muted">Technology</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

function showPage(pageName, jobId = null) {
    // Hide all pages
    const pages = document.querySelectorAll('.company-page-content');
    pages.forEach(page => page.classList.remove('active'));
    
    // Show selected page
    const targetPage = document.getElementById(pageName + '-page');
    if (targetPage) {
        targetPage.classList.add('active');
    }
    
    // Update active nav item
    const navItems = document.querySelectorAll('.company-nav-item');
    navItems.forEach(item => item.classList.remove('active'));
    
    const activeNavItem = document.querySelector(`[onclick="showPage('${pageName}')"]`);
    if (activeNavItem) {
        activeNavItem.classList.add('active');
    }
    
    // Handle specific page logic
    if (pageName === 'applicants' && jobId) {
        // Filter applicants by job ID if provided
        filterApplicantsByJob(jobId);
    }
}

function filterApplicants() {
    const jobFilter = document.getElementById('jobFilter');
    const selectedJobId = jobFilter.value;
    const applicantCards = document.querySelectorAll('.company-applicant-card');
    
    applicantCards.forEach(card => {
        const cardJobId = card.getAttribute('data-job-id');
        if (selectedJobId === '' || cardJobId === selectedJobId) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function searchApplicants() {
    const searchInput = document.getElementById('applicantSearch');
    const searchTerm = searchInput.value.toLowerCase();
    const applicantCards = document.querySelectorAll('.company-applicant-card');
    
    applicantCards.forEach(card => {
        const applicantName = card.getAttribute('data-applicant-name');
        if (applicantName.includes(searchTerm)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function filterApplicantsByJob(jobId) {
    const applicantCards = document.querySelectorAll('.company-applicant-card');
    
    applicantCards.forEach(card => {
        const cardJobId = card.getAttribute('data-job-id');
        if (cardJobId === jobId.toString()) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function viewApplicantDetails(applicationId) {
    // Redirect to applicant detail page
    window.location.href = `/company/applicants/${applicationId}/`;
}

function updateApplicationStatus(applicationId, status) {
    if (confirm(`Are you sure you want to ${status} this application?`)) {
        // Create a form to submit the status update
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/company/applications/${applicationId}/update/`;
        
        // Add CSRF token
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
        
        // Add status input
        const statusInput = document.createElement('input');
        statusInput.type = 'hidden';
        statusInput.name = 'status';
        statusInput.value = status;
        form.appendChild(statusInput);
        
        // Submit form
        document.body.appendChild(form);
        form.submit();
    }
}

function showAISummary(applicationId) {
    // Show loading modal
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="fas fa-robot me-2"></i>AI Candidate Analysis
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5>AI is analyzing the candidate...</h5>
                    <p class="text-muted">This may take a few seconds</p>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Call AI API
    fetch('/api/company/ai/candidate-analysis/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: JSON.stringify({
            application_id: applicationId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const analysis = data.analysis;
            
            // Update modal with AI results
            modal.querySelector('.modal-body').innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="text-center">
                            <div class="h2 mb-0 text-primary">${analysis.match_score}%</div>
                            <div class="small text-muted">Match Score</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-center">
                            <div class="h5 mb-0 text-success">$${analysis.salary_expectation.min.toLocaleString()} - $${analysis.salary_expectation.max.toLocaleString()}</div>
                            <div class="small text-muted">Expected Salary</div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-chart-line me-2 text-success"></i>Strengths</h6>
                        <ul class="list-unstyled">
                            ${analysis.strengths.map(strength => `<li><i class="fas fa-check text-success me-2"></i>${strength}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-exclamation-triangle me-2 text-warning"></i>Areas to Consider</h6>
                        <ul class="list-unstyled">
                            ${analysis.concerns.map(concern => `<li><i class="fas fa-info-circle text-warning me-2"></i>${concern}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h6><i class="fas fa-lightbulb me-2 text-primary"></i>AI Recommendation</h6>
                    <div class="alert alert-info">
                        <strong>${analysis.recommendation}</strong>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6><i class="fas fa-target me-2 text-info"></i>Interview Focus</h6>
                        <ul class="list-unstyled">
                            ${analysis.interview_focus.map(focus => `<li><i class="fas fa-arrow-right text-primary me-2"></i>${focus}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-clock me-2 text-warning"></i>Hiring Timeline</h6>
                        <p class="mb-1"><strong>${analysis.hiring_timeline}</strong></p>
                        <small class="text-muted">Expected time to hire</small>
                    </div>
                </div>
                
                ${analysis.risk_factors ? `
                <div class="mt-3">
                    <h6><i class="fas fa-exclamation-circle me-2 text-danger"></i>Risk Factors</h6>
                    <ul class="list-unstyled">
                        ${analysis.risk_factors.map(risk => `<li><i class="fas fa-warning text-warning me-2"></i>${risk}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
            `;
            
            // Add footer with schedule button
            modal.querySelector('.modal-content').innerHTML += `
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="scheduleWithAI(${applicationId})">
                        <i class="fas fa-calendar-plus me-1"></i>Schedule Interview
                    </button>
                </div>
            `;
        } else {
            modal.querySelector('.modal-body').innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Error:</strong> ${data.error || 'Failed to analyze candidate'}
                </div>
            `;
        }
    })
    .catch(error => {
        modal.querySelector('.modal-body').innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Error:</strong> Failed to connect to AI service
            </div>
        `;
    });
    
    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });
}

function scheduleWithAI(applicationId) {
    // Show loading modal
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="fas fa-robot me-2"></i>AI Interview Scheduler
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5>AI is finding the best time for your interview...</h5>
                    <p class="text-muted">This may take a few seconds</p>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Call AI API
    fetch('/api/company/ai/interview-scheduler/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: JSON.stringify({
            application_id: applicationId,
            preferred_times: ['Monday 2:00 PM', 'Tuesday 10:00 AM', 'Wednesday 3:00 PM']
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const scheduling = data.scheduling;
            
            // Update modal with AI results
            modal.querySelector('.modal-body').innerHTML = `
                <div class="text-center mb-4">
                    <i class="fas fa-calendar-check fa-3x text-success mb-3"></i>
                    <h5>AI has found optimal interview times</h5>
                    <p class="text-muted">Here are the best times for your interview:</p>
                </div>
                
                <div class="alert alert-success">
                    <i class="fas fa-star me-2"></i>
                    <strong>Recommended:</strong> ${scheduling.best_time}
                </div>
                
                <div class="mb-3">
                    <h6><i class="fas fa-clock me-2 text-primary"></i>Suggested Times</h6>
                    <ul class="list-unstyled">
                        ${scheduling.suggested_times.map(time => `<li><i class="fas fa-calendar me-2 text-primary"></i>${time}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6><i class="fas fa-hourglass-half me-2 text-info"></i>Duration</h6>
                        <p class="mb-0"><strong>${scheduling.interview_duration}</strong></p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-video me-2 text-success"></i>Format</h6>
                        <p class="mb-0"><strong>${scheduling.interview_format}</strong></p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6><i class="fas fa-lightbulb me-2 text-warning"></i>Preparation Tips</h6>
                    <ul class="list-unstyled">
                        ${scheduling.preparation_tips.map(tip => `<li><i class="fas fa-check text-success me-2"></i>${tip}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>AI Reasoning:</strong> ${scheduling.reasoning}
                </div>
            `;
            
            // Add footer with action buttons
            modal.querySelector('.modal-content').innerHTML += `
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="startAIScheduling(${applicationId})">
                        <i class="fas fa-magic me-1"></i>Start AI Scheduling
                    </button>
                </div>
            `;
        } else {
            modal.querySelector('.modal-body').innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Error:</strong> ${data.error || 'Failed to get scheduling suggestions'}
                </div>
            `;
        }
    })
    .catch(error => {
        modal.querySelector('.modal-body').innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Error:</strong> Failed to connect to AI service
            </div>
        `;
    });
    
    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });
}

function startAIScheduling(applicationId) {
    // Simulate AI scheduling process
    const button = event.target;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>AI is working...';
    button.disabled = true;
    
    setTimeout(() => {
        button.innerHTML = '<i class="fas fa-check me-2"></i>Interview Scheduled!';
        button.className = 'btn btn-success';
        
        setTimeout(() => {
            bootstrap.Modal.getInstance(button.closest('.modal')).hide();
        }, 2000);
    }, 3000);
}

// AI Job Posting Generator Functions
function generateAIJobPosting() {
    const jobPrompt = document.getElementById('aiJobPrompt').value.trim();
    
    if (!jobPrompt) {
        alert('Please describe the job you want to post.');
        return;
    }
    
    // Show loading modal
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="fas fa-magic me-2"></i>AI Job Posting Generator
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="spinner-border text-success mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5>AI is generating your job posting...</h5>
                    <p class="text-muted">This may take a few seconds</p>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Call AI API
    fetch('/api/company/ai/generate-job-posting/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: JSON.stringify({
            job_prompt: jobPrompt,
            company_context: {
                skills: '{{ company.industry }}'
            }
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const jobData = data.job_data;
            
            // Update modal with AI results
            modal.querySelector('.modal-body').innerHTML = `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Job posting generated successfully!</strong> Review the details below and click "Fill Form" to populate the job posting form.
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-briefcase me-2 text-primary"></i>Job Details</h6>
                        <p><strong>Title:</strong> ${jobData.title}</p>
                        <p><strong>Location:</strong> ${jobData.location}</p>
                        <p><strong>Employment Type:</strong> ${jobData.employment_type}</p>
                        <p><strong>Experience Level:</strong> ${jobData.experience_level}</p>
                        <p><strong>Remote Work:</strong> ${jobData.remote_work}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-dollar-sign me-2 text-success"></i>Compensation</h6>
                        <p><strong>Salary Range:</strong> $${jobData.salary_range.min.toLocaleString()} - $${jobData.salary_range.max.toLocaleString()}</p>
                        <p><strong>Currency:</strong> ${jobData.salary_range.currency}</p>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h6><i class="fas fa-tasks me-2 text-info"></i>Required Skills</h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${jobData.skills_required.map(skill => `<span class="badge bg-primary">${skill}</span>`).join('')}
                    </div>
                </div>
                
                ${jobData.nice_to_have && jobData.nice_to_have.length > 0 ? `
                <div class="mt-3">
                    <h6><i class="fas fa-plus me-2 text-secondary"></i>Nice to Have</h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${jobData.nice_to_have.map(skill => `<span class="badge bg-secondary">${skill}</span>`).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div class="mt-3">
                    <h6><i class="fas fa-file-text me-2 text-warning"></i>Description Preview</h6>
                    <div class="bg-light p-3 rounded" style="max-height: 200px; overflow-y: auto;">
                        <small>${jobData.description}</small>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h6><i class="fas fa-list me-2 text-info"></i>Requirements Preview</h6>
                    <div class="bg-light p-3 rounded" style="max-height: 200px; overflow-y: auto;">
                        <small style="white-space: pre-line;">${jobData.requirements}</small>
                    </div>
                </div>
            `;
            
            // Store jobData globally and use a simpler onclick
            window.currentJobData = jobData;
            
            // Add footer with action buttons
            modal.querySelector('.modal-content').innerHTML += `
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="fillJobForm(window.currentJobData)">
                        <i class="fas fa-magic me-2"></i>Fill Form
                    </button>
                </div>
            `;
        } else {
            modal.querySelector('.modal-body').innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Error:</strong> ${data.error || 'Failed to generate job posting'}
                </div>
            `;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        modal.querySelector('.modal-body').innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Error:</strong> Failed to generate job posting. Please try again.
            </div>
        `;
    });
}

function fillJobForm(jobData) {
    console.log('fillJobForm called with:', jobData);
    
    if (!jobData) {
        console.error('No job data provided');
        alert('No job data available to fill the form');
        return;
    }
    
    try {
        // Fill the form fields with AI-generated data
        const titleField = document.querySelector('input[name="title"]');
        const locationField = document.querySelector('input[name="location"]');
        const descriptionField = document.querySelector('textarea[name="description"]');
        const salaryField = document.querySelector('input[name="salary_range"]');
        
        if (titleField) titleField.value = jobData.title || '';
        if (locationField) locationField.value = jobData.location || '';
        if (descriptionField) descriptionField.value = jobData.description || '';
        
        if (salaryField && jobData.salary_range) {
            salaryField.value = `$${jobData.salary_range.min.toLocaleString()} - $${jobData.salary_range.max.toLocaleString()}`;
        }
        
        // Set employment type
        const employmentTypeMap = {
            'Full-time': 'full_time',
            'Part-time': 'part_time',
            'Contract': 'contract',
            'Internship': 'internship'
        };
        const employmentSelect = document.querySelector('select[name="employment_type"]');
        if (employmentSelect) {
            employmentSelect.value = employmentTypeMap[jobData.employment_type] || 'full_time';
        }
        
        // Set experience level
        const experienceLevelMap = {
            'Entry': 'entry',
            'Junior': 'entry',
            'Mid-level': 'mid',
            'Senior': 'senior',
            'Executive': 'executive'
        };
        const experienceSelect = document.querySelector('select[name="experience_level"]');
        if (experienceSelect) {
            experienceSelect.value = experienceLevelMap[jobData.experience_level] || 'mid';
        }
        
        // Fill requirements if there's a requirements field
        const requirementsField = document.querySelector('textarea[name="requirements"]');
        if (requirementsField) {
            requirementsField.value = jobData.requirements || '';
        }
        
        console.log('Form filled successfully');
        
        // Close the modal
        bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
        
        // Show success message
        const toast = document.createElement('div');
        toast.className = 'toast align-items-center text-white bg-success border-0';
        toast.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-check-circle me-2"></i>Job posting form filled successfully!
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        `;
        document.body.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
        
        // Remove toast after it's hidden
        toast.addEventListener('hidden.bs.toast', () => {
            document.body.removeChild(toast);
        });
        
    } catch (error) {
        console.error('Error filling form:', error);
        alert('Error filling form: ' + error.message);
    }
}

function clearAIForm() {
    document.getElementById('aiJobPrompt').value = '';
}

// AI Job Description Assistant Functions


function getMarketSalary() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="fas fa-dollar-sign me-2"></i>Market Salary Analysis
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="fas fa-chart-bar fa-3x text-primary mb-3"></i>
                        <h5>AI-Powered Salary Insights</h5>
                        <p class="text-muted">Based on real-time market data and similar positions</p>
                    </div>
                    <div class="row text-center">
                        <div class="col-md-4">
                            <div class="h3 text-success">$85K - $120K</div>
                            <div class="small text-muted">Entry Level</div>
                        </div>
                        <div class="col-md-4">
                            <div class="h3 text-primary">$120K - $160K</div>
                            <div class="small text-muted">Mid Level</div>
                        </div>
                        <div class="col-md-4">
                            <div class="h3 text-warning">$160K - $200K</div>
                            <div class="small text-muted">Senior Level</div>
                        </div>
                    </div>
                    <div class="alert alert-success mt-3">
                        <i class="fas fa-trophy me-2"></i>
                        <strong>Competitive Range:</strong> $120K - $140K will attract top talent while staying competitive.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });
}

function checkInclusiveLanguage() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="fas fa-heart me-2"></i>Inclusive Language Check
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Great job!</strong> Your job description scores 92% on inclusive language.
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check text-success me-2"></i>Inclusive Elements</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Uses gender-neutral language</li>
                                <li><i class="fas fa-check text-success me-2"></i>Focuses on skills over credentials</li>
                                <li><i class="fas fa-check text-success me-2"></i>Welcomes diverse backgrounds</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-lightbulb text-warning me-2"></i>Suggestions</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-info-circle text-info me-2"></i>Consider adding "We welcome candidates from all backgrounds"</li>
                                <li><i class="fas fa-info-circle text-info me-2"></i>Mention flexible work arrangements</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: 92%"></div>
                        </div>
                        <small class="text-muted">Inclusivity Score: 92/100</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });
}

function applySkillsSuggestions() {
    // This would integrate with the form to add suggested skills
    alert('Skills suggestions applied to your job description!');
    bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
}

</script>
{% endblock %}