{% extends 'base.html' %}

{% block title %}Applicant: {{ application.user.get_full_name|default:application.user.username }} - JobVista{% endblock %}

{% block content %}
<div class="w-full px-6 lg:px-10 py-8" style="background: radial-gradient(1600px 900px at -10% -20%, #EEF2FF, transparent), radial-gradient(1400px 800px at 120% 0%, #F5F7FF, transparent);">
  <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">

    <main class="lg:col-span-8 space-y-6">
      <div class="flex items-center gap-4">
        <div class="w-20 h-20 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 text-3xl">
            {{ application.user.first_name|first|default:application.user.username|first|upper }}
        </div>
        <div>
            <h1 class="text-3xl font-bold" style="color: var(--text-heading);">{{ application.user.get_full_name|default:application.user.username }}</h1>
            <p class="text-gray-600">Applied to <a href="{{ application.job.get_absolute_url }}" class="link">{{ application.job.title }}</a> â€¢ {{ application.created_at|timesince }} ago</p>
            <div class="mt-2 flex items-center gap-4 text-sm text-gray-500">
                <span><i class="fas fa-envelope mr-1"></i>{{ application.user.email }}</span>
                {% if profile.phone_number %}<span><i class="fas fa-phone mr-1"></i>{{ profile.phone_number }}</span>{% endif %}
            </div>
        </div>
      </div>

      <div class="backdrop-blur bg-white/60 border rounded-2xl card-shadow" style="border-color: #ffffff33;">
        <div class="border-b p-2" style="border-color: var(--border);">
          <nav class="flex space-x-2" aria-label="Tabs">
            <a href="#" class="applicant-tab-button active-tab" data-target="tab-resume">Resume</a>
            <a href="#" class="applicant-tab-button" data-target="tab-ai-analysis">AI Analysis</a>
            <a href="#" class="applicant-tab-button" data-target="tab-notes">Internal Notes</a>
          </nav>
        </div>
        <div class="p-2 sm:p-4">
          <div id="tab-resume" class="applicant-tab-content">
            {% if profile and profile.resume %}
              <div class="text-center py-20">
                <a href="{{ profile.resume.url }}" target="_blank" class="btn-primary-brand px-5 py-3 rounded-md text-lg font-semibold">
                    <i class="fas fa-file-pdf mr-2"></i> View Resume
                </a>
                <p class="text-sm text-gray-500 mt-3">Click the button to open the resume in a new tab.</p>
              </div>
            {% else %}
              <div class="text-center py-20">
                <p class="text-gray-600">No resume was uploaded with this application.</p>
              </div>
            {% endif %}
          </div>
          <div id="tab-ai-analysis" class="applicant-tab-content hidden p-4">
            <h3 class="font-semibold mb-3 text-lg" style="color: var(--text-heading);">AI Profile Summary</h3>
            <p class="text-sm text-gray-700 mb-6">"Based on the resume, this candidate shows strong experience in backend development with Python and Django. They appear to be a good fit for a mid-level role, but may lack specific experience in GraphQL as required by the job description."</p>
            
            <h3 class="font-semibold mb-3 text-lg" style="color: var(--text-heading);">Requirements Checklist</h3>
            <ul class="space-y-2 text-sm">
                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-green-500"></i>5+ Years of Experience</li>
                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-green-500"></i>Proficiency in Python</li>
                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-green-500"></i>Experience with Django</li>
                <li class="flex items-center gap-2"><i class="fas fa-times-circle text-red-500"></i>Experience with GraphQL</li>
                <li class="flex items-center gap-2"><i class="fas fa-exclamation-circle text-yellow-500"></i>Experience with AWS (Mentioned briefly)</li>
            </ul>
          </div>
          <div id="tab-notes" class="applicant-tab-content hidden p-4">
            <h3 class="font-semibold mb-3 text-lg" style="color: var(--text-heading);">Team Notes & Activity</h3>
            <div class="space-y-4">
                <textarea class="input w-full" rows="3" placeholder="Add a note for your team..."></textarea>
                <div class="text-right">
                    <button class="btn-primary-brand px-4 py-2 rounded-lg text-sm font-semibold">Save Note</button>
                </div>
                <div class="border-t pt-4 space-y-3" style="border-color: var(--border);">
                    <div class="text-sm"><strong>You</strong> changed status to <strong>Screening</strong> <span class="text-gray-500">- 2 hours ago</span></div>
                    <div class="text-sm"><strong>Priya</strong> left a note: "Looks promising, let's schedule a call." <span class="text-gray-500">- 1 day ago</span></div>
                </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <aside class="lg:col-span-4">
      <div class="lg:sticky top-24 space-y-6">
         <div class="backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow" style="border-color:#ffffff33;">
           <h3 class="font-semibold mb-3" style="color: var(--text-heading);">Applicant Status</h3>
           <form method="post" class="space-y-2">
             {% csrf_token %}
             <select class="input w-full" name="status">
               {% for value,label in status_choices %}
                 <option value="{{ value }}" {% if application.status == value %}selected{% endif %}>{{ label }}</option>
               {% endfor %}
             </select>
             <button type="submit" class="w-full btn-secondary-brand py-2.5 rounded-lg text-sm font-semibold">Update Status</button>
           </form>
         </div>
        <div class="backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow" style="border-color:#ffffff33;">
            <div class="text-sm text-gray-600 mb-1">AI Match Score</div>
            <div class="text-4xl font-bold" style="color: var(--color-primary);">{{ match_score }}%</div>
            <div class="mt-3 text-sm">
                <p class="font-medium text-gray-800">Key Skills Match:</p>
                <div class="mt-1 flex flex-wrap gap-1">
                    <span class="pill pill-green">Python</span> <span class="pill pill-green">Django</span> <span class="pill pill-red">GraphQL</span>
                </div>
            </div>
        </div>
        <div class="backdrop-blur bg-white/60 border rounded-2xl p-6 card-shadow" style="border-color:#ffffff33;">
            <h3 class="font-semibold mb-3" style="color: var(--text-heading);">Actions</h3>
            <div class="space-y-2">
                <a href="mailto:{{ application.user.email }}" class="w-full text-center btn-secondary-brand py-2.5 rounded-lg text-sm font-semibold flex items-center justify-center gap-2">
                    <i class="fas fa-envelope"></i> Contact Applicant
                </a>
                {% if profile and profile.resume %}
                <a href="{{ profile.resume.url }}" target="_blank" class="w-full text-center btn-secondary-brand py-2.5 rounded-lg text-sm font-semibold flex items-center justify-center gap-2">
                    <i class="fas fa-download"></i> Download Resume
                </a>
                {% endif %}
            </div>
        </div>
      </div>
    </aside>

  </div>
</div>

<style>
  .card-shadow { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.04), 0 2px 4px -2px rgb(0 0 0 / 0.04); }
  .link { color: var(--color-primary); text-decoration: none; font-weight: 500; }
  .link:hover { text-decoration: underline; }
  .pill { padding: 2px 8px; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
  .pill-green { background-color: #D1FAE5; color: #065F46; } /* green-100, green-800 */
  .pill-red { background-color: #FEE2E2; color: #991B1B; } /* red-100, red-800 */
  .applicant-tab-button {
    padding: 8px 16px; border-radius: 6px; font-weight: 500;
    color: #4B5563; transition: all 0.2s ease-in-out;
  }
  .applicant-tab-button:hover { background-color: rgba(255,255,255,0.5); }
  .applicant-tab-button.active-tab {
    background-color: #FFFFFF; color: var(--color-primary); font-weight: 600;
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tab functionality for Applicant Details
  const tabButtons = document.querySelectorAll('.applicant-tab-button');
  const tabContents = document.querySelectorAll('.applicant-tab-content');
  tabButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      tabButtons.forEach(btn => btn.classList.remove('active-tab'));
      button.classList.add('active-tab');
      const targetId = button.getAttribute('data-target');
      tabContents.forEach(content => {
        content.classList.toggle('hidden', content.id !== targetId);
      });
    });
  });
});
</script>
{% endblock %}